<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Three.js Toon Sphere + Circle (XR)</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; }
  </style>
</head>
<body>
  <script type="module">
    import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.module.js';
    import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.155.0/examples/jsm/controls/OrbitControls.js';
    import { VRButton } from 'https://cdn.jsdelivr.net/npm/three@0.155.0/examples/jsm/webxr/VRButton.js';

    // Escena
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0xf0f0f0);

    // Cámara
    const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 100);
    camera.position.set(0, 1.5, 5);

    // Renderizador
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.xr.enabled = true; // Habilita XR
    document.body.appendChild(renderer.domElement);

    // Agrega el botón de VR
    document.body.appendChild(VRButton.createButton(renderer));

    // Controles
    const controls = new OrbitControls(camera, renderer.domElement);

    // Luces
    const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
    directionalLight.position.set(3, 5, 2);
    scene.add(directionalLight);

    const ambientLight = new THREE.AmbientLight(0xffffff, 0.2);
    scene.add(ambientLight);

    // Gradiente para ToonMaterial
    const loader = new THREE.TextureLoader();
    const gradientMap = loader.load('https://threejs.org/examples/textures/gradientMaps/threeTone.jpg');
    gradientMap.minFilter = THREE.NearestFilter;
    gradientMap.magFilter = THREE.NearestFilter;

    // Esfera Toon
    const sphereGeometry = new THREE.SphereGeometry(1, 32, 32);
    const toonMaterial = new THREE.MeshToonMaterial({
      color: 0x3399ff,
      gradientMap: gradientMap,
    });

    const sphereMesh = new THREE.Mesh(sphereGeometry, toonMaterial);
    sphereMesh.position.y = 1;
    scene.add(sphereMesh);

    // Borde tipo outline
    const outlineMaterial = new THREE.MeshBasicMaterial({
      color: 0x000000,
      side: THREE.BackSide,
    });

    const outlineMesh = new THREE.Mesh(sphereGeometry.clone(), outlineMaterial);
    outlineMesh.position.copy(sphereMesh.position);
    outlineMesh.scale.multiplyScalar(1.05);
    scene.add(outlineMesh);

    // Círculo en el suelo
    const circleGeometry = new THREE.CircleGeometry(2, 64);
    const circleMaterial = new THREE.MeshStandardMaterial({ color: 0xdddddd });
    const circleMesh = new THREE.Mesh(circleGeometry, circleMaterial);
    circleMesh.rotation.x = -Math.PI / 2;
    scene.add(circleMesh);

    // Animación
    function animate() {
      renderer.setAnimationLoop(() => {
        sphereMesh.rotation.y += 0.005;
        outlineMesh.rotation.y += 0.005;
        renderer.render(scene, camera);
      });
    }

    animate();

    // Resize
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>